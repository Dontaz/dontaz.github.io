<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Chart Builder</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            --bg-body-1: #667eea;
            --bg-body-2: #764ba2;
            --bg-container: #ffffff;
            --bg-input: #ffffff;
            --bg-secondary: #f7fafc;
            --border-color: #e2e8f0;
            --text-main: #4a5568;
            --text-muted: #718096;
            --accent: #667eea;
            --shadow: rgba(0, 0, 0, 0.25);
            --btn-text: white;
            --select-arrow: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%234a5568' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            --danger-color: #fc8181;
            --danger-hover: #f56565;
        }

        body.dark-mode {
            --bg-body-1: #1a202c;
            --bg-body-2: #2d3748;
            --bg-container: #171923;
            --bg-input: #2d3748;
            --bg-secondary: #2d3748;
            --border-color: #4a5568;
            --text-main: #e2e8f0;
            --text-muted: #a0aec0;
            --accent: #7f9cf5;
            --shadow: rgba(0, 0, 0, 0.5);
            --btn-text: #1a202c;
            --select-arrow: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23e2e8f0' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--bg-body-1) 0%, var(--bg-body-2) 100%);
            min-height: 100vh;
            padding: 20px;
            transition: background 0.5s ease;
            color: var(--text-main);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--bg-container);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 25px 50px -12px var(--shadow);
            transition: background 0.3s ease, box-shadow 0.3s ease;
        }

        .header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        h1 { 
            color: var(--accent); 
            font-weight: 800; 
            letter-spacing: -0.5px;
            margin: 0;
        }
        
        .header-buttons {
            display: flex;
            gap: 12px;
        }

        .icon-btn {
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            color: var(--text-main);
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .icon-btn:hover { 
            background: var(--accent);
            border-color: var(--accent);
            color: #ffffff;
            transform: translateY(-3px);
            box-shadow: 0 8px 15px -3px rgba(102, 126, 234, 0.4);
        }
        .icon-btn:active {
            transform: translateY(-1px);
            box-shadow: 0 3px 5px -1px rgba(0,0,0,0.1);
        }
        
        .controls { display: grid; gap: 24px; margin-bottom: 40px; }
        .control-group { display: flex; flex-direction: column; gap: 10px; }
        
        label { 
            font-weight: 600; 
            color: var(--text-main); 
            font-size: 14px; 
            text-transform: uppercase; 
            letter-spacing: 0.5px; 
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .checkbox-wrapper {
            display: flex; align-items: center; gap: 12px;
            cursor: pointer; 
            background: var(--bg-secondary); 
            padding: 16px;
            border-radius: 12px; 
            border: 1px solid var(--border-color); 
            transition: all 0.2s;
        }
        .checkbox-wrapper:hover { border-color: var(--accent); }
        .checkbox-wrapper input { width: 18px; height: 18px; accent-color: var(--accent); }
        .checkbox-wrapper span { text-transform: none; font-size: 15px; color: var(--text-main); }

        textarea, select, input[type="text"], input[type="number"] {
            padding: 0 14px;
            height: 40px;
            border: 2px solid var(--border-color); 
            border-radius: 12px;
            font-size: 15px; 
            width: 100%; 
            background: var(--bg-input);
            color: var(--text-main);
            transition: border-color 0.2s, background 0.3s, color 0.3s;
        }
        textarea:focus, select:focus, input:focus { outline: none; border-color: var(--accent); }

        select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: var(--select-arrow);
            background-repeat: no-repeat;
            background-position: right 16px center;
            background-size: 18px;
            padding-right: 45px !important;
            cursor: pointer;
        }
        
        .font-inputs-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; align-items: end; }
        .font-input-item { display: flex; flex-direction: column; gap: 5px; }
        .font-input-item span { font-size: 12px; color: var(--text-muted); font-weight: 600; }

        .data-table-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 15px;
            display: none;
        }
        .data-table-container.active { display: block; }
        
        .table-row {
            display: grid; 
            grid-template-columns: 40px 40px 1fr 1fr 40px; 
            gap: 10px; 
            margin-bottom: 10px; 
            align-items: center;
            transition: transform 0.15s, opacity 0.2s;
            padding-right: 5px;
        }
        .table-row.dragging {
            opacity: 0.5; 
            background: var(--bg-input); 
            border: 1px dashed var(--accent);
            border-radius: 8px; 
            cursor: grabbing;
        }
        .table-header {
            display: grid; 
            grid-template-columns: 40px 40px 1fr 1fr 40px; 
            gap: 10px; 
            margin-bottom: 10px;
            padding-right: 5px;
        }
        .table-header span {
            font-size: 12px; 
            font-weight: 600; 
            text-transform: uppercase; 
            color: var(--text-muted);
        }
        .table-header span:nth-child(2) { 
            display: flex; align-items: center; justify-content: center; 
            font-size: 16px; font-weight: 900; color: var(--accent); font-family: 'Courier New', monospace;
        }
        
        .table-num {
            display: flex; align-items: center; justify-content: center;
            height: 40px; width: 100%; font-family: 'Courier New', monospace;
            font-weight: 900; color: var(--accent); font-size: 18px;
            user-select: none; opacity: 0.5; transition: opacity 0.2s, transform 0.2s;
        }
        .table-row:hover .table-num { opacity: 1; transform: scale(1.1); }

        .drag-handle {
            cursor: grab;
            color: var(--text-muted);
            display: flex; align-items: center; justify-content: center;
            width: 40px; height: 40px; user-select: none; transition: color 0.2s;
        }
        .drag-handle svg { width: 24px; height: 24px; stroke: currentColor; }
        .drag-handle:hover { color: var(--accent); }
        .dragging .drag-handle { cursor: grabbing; }

        button.primary-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; 
            border: none; padding: 16px; border-radius: 12px;
            font-weight: 700; font-size: 16px; cursor: pointer; 
            transition: transform 0.1s, box-shadow 0.2s;
            width: 100%;
        }
        button.primary-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(102, 126, 234, 0.4); }
        
        .btn-small {
            padding: 8px 16px; font-size: 13px; 
            background: var(--bg-secondary); 
            color: var(--text-main);
            width: auto; border-radius: 8px; font-weight: 600; border: 1px solid var(--border-color);
            cursor: pointer;
        }
        .btn-small:hover { background: var(--border-color); }
        
        .btn-dashed {
            background: var(--bg-input); color: var(--text-muted); border: 1px dashed var(--border-color);
            padding: 0 15px; border-radius: 12px; cursor: pointer; font-size: 13px; font-weight: bold;
            transition: all 0.2s; height: 40px; display: flex; align-items: center; justify-content: center; gap: 8px;
            white-space: nowrap;
        }
        .btn-dashed:hover { border-color: var(--accent); color: var(--accent); }
        .btn-dashed svg { width: 16px; height: 16px; }
        
        .btn-reverse-tall { height: 62px; width: 100%; }

        .btn-remove {
            background: var(--danger-color); padding: 0; height: 40px; width: 40px; 
            border: none; color: white; border-radius: 10px; display: flex; 
            align-items: center; justify-content: center; cursor: pointer; 
            transition: background 0.2s, transform 0.1s; flex-shrink: 0;
        }
        .btn-remove:hover { background: var(--danger-hover); transform: scale(1.05); }
        .btn-remove svg { width: 18px; height: 18px; display: block; }

        .chart-container {
            position: relative; height: 550px; margin-top: 30px;
            background: var(--bg-input);
            border-radius: 24px; padding: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            transition: background 0.3s, border-color 0.3s;
        }
        
        .color-inputs-list { 
            display: grid; grid-template-columns: repeat(auto-fill, minmax(330px, 1fr)); gap: 12px; 
        }
        
        .color-row {
            display: flex; align-items: center; gap: 8px; 
            background: var(--bg-secondary);
            padding: 10px 12px 10px 10px; 
            border-radius: 12px; 
            border: 1px solid var(--border-color);
        }
        .color-row.dragging {
            opacity: 0.5; background: var(--bg-input); border: 2px dashed var(--accent); cursor: grabbing;
        }
        
        .color-num {
            margin-left: auto; font-size: 14px; font-weight: bold; color: var(--text-muted);
            background: var(--bg-input); border: 1px solid var(--border-color);
            width: 40px; height: 40px; border-radius: 10px; display: flex;
            align-items: center; justify-content: center; user-select: none; flex-shrink: 0;
        }

        .setting-label {
            margin-left: auto; font-size: 13px; font-weight: bold; color: var(--text-muted);
            background: var(--bg-input); border: 1px solid var(--border-color);
            height: 40px; padding: 0 15px; border-radius: 10px; display: flex;
            align-items: center; justify-content: center; user-select: none; white-space: nowrap;
        }

        input[type="color"] {
            -webkit-appearance: none; border: none; width: 40px; height: 40px; padding: 0;
            background: none; cursor: pointer; border-radius: 10px; overflow: hidden; flex-shrink: 0;
        }
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        input[type="color"]::-webkit-color-swatch { border: 2px solid var(--border-color); border-radius: 10px; box-sizing: border-box; }
        input[type="color"]::-moz-color-swatch { border: 2px solid var(--border-color); border-radius: 10px; box-sizing: border-box; }
        
        .hex-input { width: 85px !important; height: 40px !important; text-transform: uppercase; padding: 0 8px !important; font-family: monospace; font-weight: bold; font-size: 13px !important; }

        .export-buttons { display: flex; gap: 15px; margin-top: 30px; flex-wrap: wrap; }
        .export-buttons button { flex: 1; min-width: 200px; }
        
        #codeOutput { margin-top: 30px; padding: 25px; background: #1a202c; border-radius: 16px; display: none; color: white;}
        #codeOutput h3 { color: white; margin-bottom: 15px; text-align: left; }
        #codeArea { width: 100%; min-height: 200px; background: #171923; border: 1px solid #4a5568; color: #a0aec0; font-family: monospace; padding: 15px; border-radius: 8px; }
        
        .notification {
            position: fixed; top: 30px; right: 30px; background: #48bb78; color: white;
            padding: 16px 24px; border-radius: 12px; animation: slideIn 0.3s ease; z-index: 1000;
            font-weight: 600; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        @keyframes slideIn { from { transform: translateX(400px); } to { transform: translateX(0); } }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6); z-index: 2000;
            display: none; align-items: center; justify-content: center;
            opacity: 0; transition: opacity 0.2s;
            backdrop-filter: blur(3px);
        }
        .modal-overlay.open { display: flex; opacity: 1; }
        .modal-content {
            background: var(--bg-container); padding: 30px; border-radius: 20px; width: 90%; max-width: 400px;
            text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.4); transform: scale(0.9); transition: transform 0.2s, background 0.3s, color 0.3s;
            color: var(--text-main);
        }
        .modal-overlay.open .modal-content { transform: scale(1); }
        .modal-content h3 { color: var(--accent); margin-bottom: 15px; }
        .modal-content p { margin-bottom: 10px; font-size: 15px; line-height: 1.5; color: var(--text-main); }
        .modal-content a { color: var(--accent); text-decoration: none; font-weight: bold; }
        .modal-content a:hover { text-decoration: underline; }
        .modal-close { margin-top: 20px; width: 100%; }
        
        .modal-buttons {
            display: flex; gap: 15px; margin-top: 25px; justify-content: center;
        }
        .modal-buttons button {
            flex: 1; min-width: 100px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-row">
            <h1 id="ui-title">üìä –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –≥—Ä–∞—Ñ–∏–∫–æ–≤</h1>
            <div class="header-buttons">
                <button class="icon-btn" onclick="toggleLanguage()" id="langBtn" title="–Ø–∑—ã–∫ / Language">RU</button>
                <button class="icon-btn" onclick="triggerImport()" id="btn-load-proj" title="–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–µ–∫—Ç">üìÇ</button>
                <button class="icon-btn" onclick="exportProject()" id="btn-save-proj" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–µ–∫—Ç">üíæ</button>
                <button class="icon-btn" onclick="toggleInputMode()" id="modeToggleBtn" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≤–∏–¥ –≤–≤–æ–¥–∞">üìù</button>
                <button class="icon-btn" onclick="confirmReset()" id="btn-reset-all" title="–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë">üîÑ</button>
                <button class="icon-btn" onclick="toggleInfo()" id="btn-info" title="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è">‚ÑπÔ∏è</button>
                <button class="icon-btn" onclick="toggleTheme()" id="themeToggleBtn" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåû</button>
            </div>
        </div>

        <input type="file" id="importFile" style="display:none" accept=".json" onchange="importProject(this)">

        <div class="controls">
            <div class="control-group">
                <label id="ui-label-type">–¢–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞</label>
                <select id="chartType" onchange="updateChart()">
                    <option value="bar">–°—Ç–æ–ª–±—á–∞—Ç—ã–π (Bar)</option>
                    <option value="progressbar">–ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä (Progress)</option>
                    <option value="singleline">–û–¥–Ω–∞ –ª–∏–Ω–∏—è (Single Line)</option>
                    <option value="line">–õ–∏–Ω–µ–π–Ω—ã–π (Line)</option>
                    <option value="pie">–ö—Ä—É–≥–æ–≤–æ–π (Pie)</option>
                    <option value="doughnut">–ö–æ–ª—å—Ü–µ–≤–æ–π (Doughnut)</option>
                    <option value="polarArea">–ü–æ–ª—è—Ä–Ω—ã–π (Polar)</option>
                    <option value="radar">–†–∞–¥–∞—Ä–Ω—ã–π (Radar)</option>
                </select>
            </div>

            <div id="listViewContainer">
                <div class="control-group">
                    <label id="ui-label-names">–ú–µ—Ç–∫–∏ (–û—Å—å X / –°–µ–∫—Ç–æ—Ä–∞) —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é</label>
                    <input type="text" id="labels" value="Abc, Bca, Cba" oninput="syncInputsToTable(); updateChart()">
                </div>
                <div class="control-group" style="margin-top: 24px">
                    <label id="ui-label-data">–î–∞–Ω–Ω—ã–µ (–ß–∏—Å–ª–∞) —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é</label>
                    <input type="text" id="data" value="50, 30, 20" oninput="syncInputsToTable(); updateChart()">
                </div>
            </div>

            <div id="tableViewContainer" class="data-table-container">
                <div class="table-header">
                    <span></span>
                    <span>#</span>
                    <span id="ui-th-name">–ù–∞–∑–≤–∞–Ω–∏–µ</span>
                    <span id="ui-th-value">–ó–Ω–∞—á–µ–Ω–∏–µ</span>
                    <span></span>
                </div>
                <div id="tableRows"></div>
                <button class="btn-small" id="ui-btn-add-row" style="margin-top: 10px; width: 100%" onclick="addTableRow()">+ –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É</button>
            </div>

            <div class="control-group">
                <label id="ui-label-chart-title">–ó–∞–≥–æ–ª–æ–≤–æ–∫ –≥—Ä–∞—Ñ–∏–∫–∞</label>
                <input type="text" id="chartTitle" value="–†–∞—Å–ø–æ—Ä—è–¥–æ–∫ –¥–Ω—è" oninput="updateChart()">
            </div>

            <div class="control-group">
                <label id="ui-label-legend">–õ–µ–≥–µ–Ω–¥–∞</label>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; align-items: center;">
                    <select id="legendPosition" onchange="updateChart()">
                        <option value="top">–°–≤–µ—Ä—Ö—É</option>
                        <option value="bottom" selected>–°–Ω–∏–∑—É</option>
                        <option value="left">–°–ª–µ–≤–∞</option>
                        <option value="right">–°–ø—Ä–∞–≤–∞</option>
                    </select>
                    <label class="checkbox-wrapper" style="margin: 0; padding: 0 16px; height: 40px;">
                        <input type="checkbox" id="showLegendValues" onchange="updateChart()">
                        <span id="ui-label-show-values" style="font-size: 14px;">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è</span>
                    </label>
                </div>
            </div>

            <div class="control-group">
                <label id="ui-label-fonts">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —à—Ä–∏—Ñ—Ç–∞ (px)</label>
                <div class="font-inputs-grid">
                    <div class="font-input-item">
                        <span id="ui-label-f-title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</span>
                        <input type="number" id="fontSizeTitle" value="20" oninput="updateChart()">
                    </div>
                    <div class="font-input-item">
                        <span id="ui-label-f-legend">–õ–µ–≥–µ–Ω–¥–∞</span>
                        <input type="number" id="fontSizeLegend" value="14" oninput="updateChart()">
                    </div>
                    <div class="font-input-item">
                        <span id="ui-label-f-axis">–û—Å–∏ / –ú–µ—Ç–∫–∏</span>
                        <input type="number" id="fontSizeAxis" value="12" oninput="updateChart()">
                    </div>
                    <button class="btn-dashed" onclick="resetFonts()" id="ui-btn-reset" title="–°–±—Ä–æ—Å–∏—Ç—å">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" /><path d="M3 3v5h5" /></svg>
                        –°–±—Ä–æ—Å–∏—Ç—å
                    </button>
                </div>
            </div>

            <div class="control-group">
                <div class="section-header">
                    <label id="ui-label-palette" style="margin:0">–¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞</label>
                    <button type="button" id="ui-btn-add-color" class="btn-small" onclick="addNewColorInput(null, true)">+ –î–æ–±–∞–≤–∏—Ç—å —Ü–≤–µ—Ç</button>
                </div>
                <div id="dataColorsList" class="color-inputs-list"></div>
            </div>

            <div class="control-group">
                <div class="section-header">
                    <label id="ui-label-appearance">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</label>
                </div>
                <div class="color-inputs-list">
                    <div class="color-row">
                        <input type="color" id="bgColor" value="#ffffff" onchange="syncHex('bgColor', 'hexBg'); updateChart();">
                        <input type="text" id="hexBg" class="hex-input" value="#ffffff" oninput="syncColor('hexBg', 'bgColor'); updateChart();">
                        <span class="setting-label" id="ui-label-bg">–§–æ–Ω</span>
                    </div>
                    <div class="color-row">
                        <input type="color" id="textColor" value="#4a5568" onchange="syncHex('textColor', 'hexText'); updateChart();">
                        <input type="text" id="hexText" class="hex-input" value="#4a5568" oninput="syncColor('hexText', 'textColor'); updateChart();">
                        <span class="setting-label" id="ui-label-text">–¢–µ–∫—Å—Ç</span>
                    </div>
                    <button class="btn-dashed btn-reverse-tall" onclick="swapThemeColors()" id="ui-btn-reverse" title="–†–µ–≤–µ—Ä—Å">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3 4 7l4 4" /><path d="M4 7h16" /><path d="M16 21l4-4-4-4" /><path d="M20 17H4" /></svg>
                        –†–µ–≤–µ—Ä—Å
                    </button>
                </div>
            </div>
        </div>

        <div class="chart-container" id="chartContainer">
            <canvas id="myChart"></canvas>
        </div>

        <div class="export-buttons">
            <button class="primary-btn" id="ui-btn-download" onclick="downloadImage()">üì• –°–∫–∞—á–∞—Ç—å PNG</button>
            <button class="primary-btn" id="ui-btn-markdown" onclick="copyMarkdown()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å Markdown</button>
            <button class="primary-btn" id="ui-btn-html" onclick="copyHTML()">üíª HTML –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏</button>
        </div>

        <div id="codeOutput">
            <h3 id="ui-code-title">–ö–æ–¥ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏:</h3>
            <textarea id="codeArea" readonly></textarea>
        </div>
    </div>

    <div id="infoModal" class="modal-overlay" onclick="toggleInfo()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h3 id="ui-modal-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            <p id="ui-modal-author">–ê–≤—Ç–æ—Ä: <strong>Dontaz</strong></p>
            <p><span id="ui-modal-github">–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞ GitHub</span>: <a href="https://github.com/dontaz" target="_blank">@dontaz</a></p>
            <button class="primary-btn modal-close" id="ui-modal-close" onclick="toggleInfo()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <div id="resetModal" class="modal-overlay" onclick="closeResetModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h3 id="ui-modal-reset-title">–°–±—Ä–æ—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫</h3>
            <p id="ui-modal-reset-msg">–í—ã —É–≤–µ—Ä–µ–Ω—ã? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ —Å–±—Ä–æ—Å–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.</p>
            <div class="modal-buttons">
                <button class="btn-small" id="ui-btn-cancel" onclick="closeResetModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="primary-btn" id="ui-btn-confirm" style="background: var(--danger-color);" onclick="executeReset()">–°–±—Ä–æ—Å–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        let chart = null;
        let colorCounter = 0;
        const defaultColors = ['#667eea', '#764ba2', '#f093fb', '#42e695', '#3bb2b8'];
        let isTableMode = false;
        let draggedTableItem = null;
        let currentLang = 'ru';

        const translations = {
            ru: {
                title: "üìä –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –≥—Ä–∞—Ñ–∏–∫–æ–≤",
                type: "–¢–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞",
                lblNames: "–ú–µ—Ç–∫–∏ (–û—Å—å X / –°–µ–∫—Ç–æ—Ä–∞) —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é",
                lblData: "–î–∞–Ω–Ω—ã–µ (–ß–∏—Å–ª–∞) —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é",
                thName: "–ù–∞–∑–≤–∞–Ω–∏–µ",
                thValue: "–ó–Ω–∞—á–µ–Ω–∏–µ",
                btnAddRow: "+ –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É",
                chartTitle: "–ó–∞–≥–æ–ª–æ–≤–æ–∫ –≥—Ä–∞—Ñ–∏–∫–∞",
                legend: "–õ–µ–≥–µ–Ω–¥–∞",
                showValues: "–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è",
                fonts: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —à—Ä–∏—Ñ—Ç–∞ (px)",
                fTitle: "–ó–∞–≥–æ–ª–æ–≤–æ–∫",
                fLegend: "–õ–µ–≥–µ–Ω–¥–∞",
                fAxis: "–û—Å–∏ / –ú–µ—Ç–∫–∏",
                btnReset: "–°–±—Ä–æ—Å–∏—Ç—å",
                palette: "–¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞",
                btnAddColor: "+ –î–æ–±–∞–≤–∏—Ç—å —Ü–≤–µ—Ç",
                appearance: "–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ",
                bg: "–§–æ–Ω",
                txt: "–¢–µ–∫—Å—Ç",
                btnReverse: "–†–µ–≤–µ—Ä—Å",
                btnDown: "üì• –°–∫–∞—á–∞—Ç—å PNG",
                btnMark: "üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å Markdown",
                btnHtml: "üíª HTML –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏",
                codeTitle: "–ö–æ–¥ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏:",
                mTitle: "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",
                mAuthor: "–ê–≤—Ç–æ—Ä: <strong>Dontaz</strong>",
                mGithub: "–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞ GitHub",
                mClose: "–ó–∞–∫—Ä—ã—Ç—å",
                optBar: "–°—Ç–æ–ª–±—á–∞—Ç—ã–π (Bar)",
                optProg: "–ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä (Progress)",
                optLine: "–õ–∏–Ω–µ–π–Ω—ã–π (Line)",
                optPie: "–ö—Ä—É–≥–æ–≤–æ–π (Pie)",
                optRing: "–ö–æ–ª—å—Ü–µ–≤–æ–π (Doughnut)",
                optPolar: "–ü–æ–ª—è—Ä–Ω—ã–π (Polar)",
                optRadar: "–†–∞–¥–∞—Ä–Ω—ã–π (Radar)",
                optSingle: "–û–¥–Ω–∞ –ª–∏–Ω–∏—è (Single Line)",
                posTop: "–°–≤–µ—Ä—Ö—É",
                posBot: "–°–Ω–∏–∑—É",
                posLeft: "–°–ª–µ–≤–∞",
                posRight: "–°–ø—Ä–∞–≤–∞",
                plName: "–ù–∞–∑–≤–∞–Ω–∏–µ",
                plNum: "–ß–∏—Å–ª–æ",
                tipLoad: "–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–µ–∫—Ç",
                tipSave: "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–µ–∫—Ç",
                tipView: "–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≤–∏–¥ –≤–≤–æ–¥–∞",
                tipInfo: "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",
                tipTheme: "–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É",
                tipReset: "–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë",
                modalResetTitle: "–°–±—Ä–æ—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫",
                msgReset: "–í—ã —É–≤–µ—Ä–µ–Ω—ã? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ —Å–±—Ä–æ—Å–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.",
                btnCancel: "–û—Ç–º–µ–Ω–∞",
                btnConfirm: "–°–±—Ä–æ—Å–∏—Ç—å"
            },
            en: {
                title: "üìä Chart Builder",
                type: "Chart Type",
                lblNames: "Labels (X-axis / Sectors) separated by commas",
                lblData: "Data (Numbers) separated by commas",
                thName: "Label",
                thValue: "Value",
                btnAddRow: "+ Add Row",
                chartTitle: "Chart Title",
                legend: "Legend",
                showValues: "Show Values",
                fonts: "Font Settings (px)",
                fTitle: "Title",
                fLegend: "Legend",
                fAxis: "Axis / Labels",
                btnReset: "Reset",
                palette: "Color Palette",
                btnAddColor: "+ Add Color",
                appearance: "Appearance",
                bg: "Background",
                txt: "Text",
                btnReverse: "Reverse",
                btnDown: "üì• Download PNG",
                btnMark: "üìã Copy Markdown",
                btnHtml: "üíª Copy HTML Code",
                codeTitle: "Embed Code:",
                mTitle: "Information",
                mAuthor: "Author: <strong>Dontaz</strong>",
                mGithub: "GitHub Page",
                mClose: "Close",
                optBar: "Bar Chart",
                optProg: "Progress Bar",
                optLine: "Line Chart",
                optPie: "Pie Chart",
                optRing: "Doughnut Chart",
                optPolar: "Polar Area",
                optRadar: "Radar Chart",
                optSingle: "Single Line",
                posTop: "Top",
                posBot: "Bottom",
                posLeft: "Left",
                posRight: "Right",
                plName: "Label",
                plNum: "Number",
                tipLoad: "Load Project",
                tipSave: "Save Project",
                tipView: "Toggle Input View",
                tipInfo: "Information",
                tipTheme: "Toggle Theme",
                tipReset: "Reset All",
                modalResetTitle: "Reset Settings",
                msgReset: "Are you sure? This will reset all data and settings to defaults.",
                btnCancel: "Cancel",
                btnConfirm: "Reset"
            }
        };

        window.onload = function () {
            const savedTheme = localStorage.getItem('chartBuilderTheme');
            if (savedTheme === 'dark') toggleTheme();

            const savedMode = localStorage.getItem('chartBuilderInputMode');
            if (savedMode === 'table' || !savedMode) {
                toggleInputMode();
            }

            const savedLang = localStorage.getItem('chartBuilderLang');
            if (savedLang && translations[savedLang]) {
                currentLang = savedLang;
            }
            applyLanguage(currentLang);

            const savedColors = localStorage.getItem('chartBuilderColors');
            let colorsLoaded = false;
            if (savedColors) {
                try {
                    const parsedColors = JSON.parse(savedColors);
                    if (Array.isArray(parsedColors) && parsedColors.length > 0) {
                        parsedColors.forEach(c => addNewColorInput(c, false));
                        colorsLoaded = true;
                    }
                } catch (e) { console.error("Error loading colors", e); }
            }

            if (!colorsLoaded) {
                defaultColors.forEach(c => addNewColorInput(c, false));
            }

            updateChart();
        };

        function toggleLanguage() {
            currentLang = currentLang === 'ru' ? 'en' : 'ru';
            localStorage.setItem('chartBuilderLang', currentLang);
            applyLanguage(currentLang);
        }

        function applyLanguage(lang) {
            const t = translations[lang];
            document.getElementById('langBtn').textContent = lang.toUpperCase();

            const setTxt = (id, txt) => {
                const el = document.getElementById(id);
                if (el) el.innerText = txt;
            };

            setTxt('ui-title', t.title);
            setTxt('ui-label-type', t.type);
            setTxt('ui-label-names', t.lblNames);
            setTxt('ui-label-data', t.lblData);
            setTxt('ui-th-name', t.thName);
            setTxt('ui-th-value', t.thValue);
            setTxt('ui-btn-add-row', t.btnAddRow);
            setTxt('ui-label-chart-title', t.chartTitle);
            setTxt('ui-label-legend', t.legend);
            setTxt('ui-label-show-values', t.showValues);
            setTxt('ui-label-fonts', t.fonts);
            setTxt('ui-label-f-title', t.fTitle);
            setTxt('ui-label-f-legend', t.fLegend);
            setTxt('ui-label-f-axis', t.fAxis);
            setTxt('ui-label-palette', t.palette);
            setTxt('ui-btn-add-color', t.btnAddColor);
            setTxt('ui-label-appearance', t.appearance);
            setTxt('ui-label-bg', t.bg);
            setTxt('ui-label-text', t.txt);
            setTxt('ui-btn-download', t.btnDown);
            setTxt('ui-btn-markdown', t.btnMark);
            setTxt('ui-btn-html', t.btnHtml);
            setTxt('ui-code-title', t.codeTitle);
            setTxt('ui-modal-title', t.mTitle);
            setTxt('ui-modal-github', t.mGithub);
            setTxt('ui-modal-close', t.mClose);

            setTxt('ui-modal-reset-title', t.modalResetTitle);
            setTxt('ui-modal-reset-msg', t.msgReset);
            setTxt('ui-btn-cancel', t.btnCancel);
            setTxt('ui-btn-confirm', t.btnConfirm);

            const authorEl = document.getElementById('ui-modal-author');
            if (authorEl) authorEl.innerHTML = t.mAuthor;

            const btnReset = document.getElementById('ui-btn-reset');
            if (btnReset) btnReset.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg> ${t.btnReset}`;

            const btnReverse = document.getElementById('ui-btn-reverse');
            if (btnReverse) btnReverse.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3 4 7l4 4"/><path d="M4 7h16"/><path d="M16 21l4-4-4-4"/><path d="M20 17H4"/></svg> ${t.btnReverse}`;

            document.getElementById('btn-load-proj').title = t.tipLoad;
            document.getElementById('btn-save-proj').title = t.tipSave;
            document.getElementById('modeToggleBtn').title = t.tipView;
            document.getElementById('btn-info').title = t.tipInfo;
            document.getElementById('themeToggleBtn').title = t.tipTheme;
            document.getElementById('btn-reset-all').title = t.tipReset;

            const typeOpts = document.getElementById('chartType').options;
            typeOpts[0].text = t.optBar;
            typeOpts[1].text = t.optProg;
            typeOpts[2].text = t.optSingle;
            typeOpts[3].text = t.optLine;
            typeOpts[4].text = t.optPie;
            typeOpts[5].text = t.optRing;
            typeOpts[6].text = t.optPolar;
            typeOpts[7].text = t.optRadar;

            const posOpts = document.getElementById('legendPosition').options;
            posOpts[0].text = t.posTop;
            posOpts[1].text = t.posBot;
            posOpts[2].text = t.posLeft;
            posOpts[3].text = t.posRight;

            const textInputs = document.querySelectorAll('#tableRows input[type="text"]');
            textInputs.forEach(i => i.placeholder = t.plName);
            const numInputs = document.querySelectorAll('#tableRows input[type="number"]');
            numInputs.forEach(i => i.placeholder = t.plNum);
        }

        function toggleInfo() {
            const modal = document.getElementById('infoModal');
            modal.classList.toggle('open');
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            document.getElementById('themeToggleBtn').innerHTML = isDark ? 'üåö' : 'üåû';
            localStorage.setItem('chartBuilderTheme', isDark ? 'dark' : 'light');
        }

        function toggleInputMode() {
            isTableMode = !isTableMode;
            const listDiv = document.getElementById('listViewContainer');
            const tableDiv = document.getElementById('tableViewContainer');
            const btn = document.getElementById('modeToggleBtn');
            if (isTableMode) {
                syncInputsToTable();
                listDiv.style.display = 'none';
                tableDiv.classList.add('active');
                btn.innerHTML = '‚ñ¶';
            } else {
                syncTableToInputs();
                tableDiv.classList.remove('active');
                listDiv.style.display = 'block';
                btn.innerHTML = 'üìù';
            }
            localStorage.setItem('chartBuilderInputMode', isTableMode ? 'table' : 'list');
        }

        function syncInputsToTable() {
            const labels = document.getElementById('labels').value.split(',').map(s => s.trim());
            const data = document.getElementById('data').value.split(',').map(s => s.trim());
            const container = document.getElementById('tableRows');
            container.innerHTML = '';
            const maxLen = Math.max(labels.length, data.length);
            for (let i = 0; i < maxLen; i++) {
                if (!labels[i] && !data[i]) continue;
                addTableRowHTML(labels[i] || '', data[i] || '');
            }
            updateTableNumbers();
        }

        function syncTableToInputs() {
            const rows = document.querySelectorAll('#tableRows .table-row');
            const labelsArr = [];
            const dataArr = [];
            rows.forEach(row => {
                const inputs = row.querySelectorAll('input');
                labelsArr.push(inputs[0].value.trim());
                dataArr.push(inputs[1].value.trim());
            });
            document.getElementById('labels').value = labelsArr.join(', ');
            document.getElementById('data').value = dataArr.join(', ');
            updateChart();
        }

        function updateTableNumbers() {
            const rows = document.querySelectorAll('#tableRows .table-row');
            rows.forEach((row, index) => {
                row.querySelector('.table-num').textContent = index + 1;
            });
        }

        function addTableRowHTML(labelVal = '', dataVal = '') {
            const container = document.getElementById('tableRows');
            const div = document.createElement('div');
            div.className = 'table-row';

            div.innerHTML = `
                    <span class="drag-handle" title="Drag">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="12" r="1"/><circle cx="9" cy="5" r="1"/><circle cx="9" cy="19" r="1"/><circle cx="15" cy="12" r="1"/><circle cx="15" cy="5" r="1"/><circle cx="15" cy="19" r="1"/></svg>
                    </span>
                    <span class="table-num"></span>
                    <input type="text" placeholder="${translations[currentLang].plName}" value="${labelVal}" oninput="syncTableToInputs()">
                    <input type="number" placeholder="${translations[currentLang].plNum}" value="${dataVal}" oninput="syncTableToInputs()">
                    <button class="btn-remove" onclick="removeTableRow(this)" title="Remove">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                `;

            const handle = div.querySelector('.drag-handle');
            handle.addEventListener('mousedown', () => div.setAttribute('draggable', 'true'));
            div.addEventListener('mouseup', () => div.setAttribute('draggable', 'false'));

            div.addEventListener('dragstart', function (e) {
                draggedTableItem = this;
                setTimeout(() => this.classList.add('dragging'), 0);
            });

            div.addEventListener('dragend', function (e) {
                this.classList.remove('dragging');
                this.setAttribute('draggable', 'false');
                draggedTableItem = null;
                updateTableNumbers();
                syncTableToInputs();
            });

            div.addEventListener('dragenter', function (e) {
                e.preventDefault();
                if (this !== draggedTableItem && draggedTableItem) {
                    const rowsContainer = document.getElementById('tableRows');
                    const children = Array.from(rowsContainer.children);
                    const currentIndex = children.indexOf(draggedTableItem);
                    const targetIndex = children.indexOf(this);
                    if (currentIndex < targetIndex) rowsContainer.insertBefore(draggedTableItem, this.nextSibling);
                    else rowsContainer.insertBefore(draggedTableItem, this);
                }
            });

            div.addEventListener('dragover', function (e) { e.preventDefault(); });
            container.appendChild(div);
        }

        function addTableRow() { addTableRowHTML(); updateTableNumbers(); syncTableToInputs(); }
        function removeTableRow(btn) {
            btn.closest('.table-row').remove();
            updateTableNumbers();
            syncTableToInputs();
        }

        let draggedItem = null;

        function saveColors() {
            const colors = getActiveColors();
            localStorage.setItem('chartBuilderColors', JSON.stringify(colors));
        }

        function updateColorNumbers() {
            const rows = document.querySelectorAll('#dataColorsList .color-row');
            rows.forEach((row, index) => {
                row.querySelector('.color-num').textContent = index + 1;
            });
        }

        function addNewColorInput(colorVal, save = true) {
            colorCounter++;
            const container = document.getElementById('dataColorsList');
            if (!colorVal) colorVal = defaultColors[colorCounter % defaultColors.length] || '#000000';

            const div = document.createElement('div');
            div.className = 'color-row';
            div.id = `color-group-${colorCounter}`;

            div.innerHTML = `
                    <span class="drag-handle" title="Drag">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="12" r="1"/><circle cx="9" cy="5" r="1"/><circle cx="9" cy="19" r="1"/><circle cx="15" cy="12" r="1"/><circle cx="15" cy="5" r="1"/><circle cx="15" cy="19" r="1"/></svg>
                    </span>
                    <input type="color" class="data-color-picker" value="${colorVal}" onchange="this.nextElementSibling.value = this.value.toUpperCase(); updateChart(); saveColors()">
                    <input type="text" class="hex-input" value="${colorVal}" oninput="this.previousElementSibling.value = this.value; updateChart(); saveColors()">
                    <span class="color-num"></span>
                    <button class="btn-remove" onclick="removeColorInput(this)" title="Remove">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                `;

            const handle = div.querySelector('.drag-handle');
            handle.addEventListener('mousedown', () => div.setAttribute('draggable', 'true'));
            div.addEventListener('mouseup', () => div.setAttribute('draggable', 'false'));

            div.addEventListener('dragstart', function (e) {
                draggedItem = this;
                setTimeout(() => this.classList.add('dragging'), 0);
            });

            div.addEventListener('dragend', function (e) {
                this.classList.remove('dragging');
                this.setAttribute('draggable', 'false');
                draggedItem = null;
                updateColorNumbers();
                updateChart();
                saveColors();
            });

            div.addEventListener('dragenter', function (e) {
                e.preventDefault();
                if (this !== draggedItem && draggedItem) {
                    const container = document.getElementById('dataColorsList');
                    const children = Array.from(container.children);
                    const currentIndex = children.indexOf(draggedItem);
                    const targetIndex = children.indexOf(this);
                    if (currentIndex < targetIndex) container.insertBefore(draggedItem, this.nextSibling);
                    else container.insertBefore(draggedItem, this);
                }
            });

            div.addEventListener('dragover', function (e) { e.preventDefault(); });
            container.appendChild(div);
            updateColorNumbers();
            if (chart) updateChart();
            if (save) saveColors();
        }

        function removeColorInput(btn) {
            const container = document.getElementById('dataColorsList');
            if (container.children.length <= 1) return;
            btn.closest('.color-row').remove();
            updateColorNumbers();
            updateChart();
            saveColors();
        }

        function getActiveColors() { return Array.from(document.querySelectorAll('.data-color-picker')).map(i => i.value); }
        function generateColorArray(baseColors, count) {
            const result = [];
            for (let i = 0; i < count; i++) result.push(baseColors[i % baseColors.length]);
            return result;
        }

        function swapThemeColors() {
            const bgInput = document.getElementById('bgColor');
            const textInput = document.getElementById('textColor');
            const bgHex = document.getElementById('hexBg');
            const textHex = document.getElementById('hexText');
            const temp = bgInput.value;
            bgInput.value = textInput.value;
            textInput.value = temp;
            bgHex.value = bgInput.value.toUpperCase();
            textHex.value = textInput.value.toUpperCase();
            updateChart();
        }

        function resetFonts() {
            document.getElementById('fontSizeTitle').value = 20;
            document.getElementById('fontSizeLegend').value = 14;
            document.getElementById('fontSizeAxis').value = 12;
            updateChart();
        }

        function confirmReset() {
            document.getElementById('resetModal').classList.add('open');
        }

        function closeResetModal() {
            document.getElementById('resetModal').classList.remove('open');
        }

        function executeReset() {
            resetToDefaults();
            closeResetModal();
        }

        function resetToDefaults() {
            // Chart Settings
            document.getElementById('chartType').value = 'bar';
            document.getElementById('labels').value = "Abc, Bca, Cba";
            document.getElementById('data').value = "50, 30, 20";
            document.getElementById('chartTitle').value = "–†–∞—Å–ø–æ—Ä—è–¥–æ–∫ –¥–Ω—è";
            document.getElementById('legendPosition').value = 'bottom';
            document.getElementById('showLegendValues').checked = false;

            // Fonts
            document.getElementById('fontSizeTitle').value = 20;
            document.getElementById('fontSizeLegend').value = 14;
            document.getElementById('fontSizeAxis').value = 12;

            // Appearance Colors
            document.getElementById('bgColor').value = "#ffffff";
            document.getElementById('hexBg').value = "#FFFFFF";
            document.getElementById('textColor').value = "#4a5568";
            document.getElementById('hexText').value = "#4A5568";

            // Palette
            const colorList = document.getElementById('dataColorsList');
            colorList.innerHTML = '';
            colorCounter = 0;
            defaultColors.forEach(c => addNewColorInput(c, false));
            saveColors();

            // Sync Table if active
            if (isTableMode) {
                syncInputsToTable();
            }

            updateChart();
            showNotification(currentLang === 'ru' ? '‚úÖ –î–∞–Ω–Ω—ã–µ —Å–±—Ä–æ—à–µ–Ω—ã' : '‚úÖ Data reset');
        }

        function getChartConfiguration(scaleMultiplier = 1) {
            const type = document.getElementById('chartType').value;
            const labels = document.getElementById('labels').value.split(',').map(s => s.trim()).filter(s => s);
            const data = document.getElementById('data').value.split(',').map(s => parseFloat(s.trim())).filter(n => !isNaN(n));
            const title = document.getElementById('chartTitle').value;
            const bgColor = document.getElementById('bgColor').value;
            const textColor = document.getElementById('textColor').value;
            const showValues = document.getElementById('showLegendValues').checked;
            const legendPos = document.getElementById('legendPosition').value;
            const baseColors = getActiveColors();
            const finalColors = generateColorArray(baseColors, data.length);

            const sizeTitleRaw = document.getElementById('fontSizeTitle').value || 20;
            const sizeLegendRaw = document.getElementById('fontSizeLegend').value || 14;
            const sizeAxisRaw = document.getElementById('fontSizeAxis').value || 12;

            const fontTitle = sizeTitleRaw * scaleMultiplier;
            const fontLegend = sizeLegendRaw * scaleMultiplier;
            const fontAxis = sizeAxisRaw * scaleMultiplier;

            const paddingBase = 10 * scaleMultiplier;
            const paddingLegend = 20 * scaleMultiplier;
            const borderWidth = 2 * scaleMultiplier;

            let chartTypeConfig = type;
            let scalesConfig = {};
            let datasetExtra = {};
            let chartData = {};

            if (type === 'progressbar') {
                chartTypeConfig = 'bar';
                const dynamicMax = Math.max(100, ...data);
                datasetExtra = { indexAxis: 'y', barThickness: 30 * scaleMultiplier, borderRadius: 20 * scaleMultiplier, backgroundColor: finalColors, borderSkipped: false };
                scalesConfig = { x: { min: 0, max: dynamicMax, grid: { display: false }, ticks: { display: false } }, y: { grid: { display: false }, ticks: { color: textColor, font: { size: fontAxis, weight: 'bold' } } } };
                chartData = { labels: labels, datasets: [{ label: title, data: data, ...datasetExtra }] };
            } else if (type === 'singleline') {
                chartTypeConfig = 'bar';
                const singleLineDatasets = labels.map((label, i) => ({
                    label: label, data: [data[i]], backgroundColor: finalColors[i], borderColor: bgColor, borderWidth: { right: borderWidth }, barThickness: 50 * scaleMultiplier, borderRadius: 10 * scaleMultiplier
                }));
                scalesConfig = { x: { stacked: true, display: false, grid: { display: false } }, y: { stacked: true, display: false, grid: { display: false } } };
                chartData = { labels: [''], datasets: singleLineDatasets };
            } else {
                if (type === 'line' || type === 'bar') {
                    scalesConfig = {
                        x: { ticks: { color: textColor, font: { size: fontAxis } }, grid: { display: false } },
                        y: { beginAtZero: true, ticks: { color: textColor, padding: paddingBase, font: { size: fontAxis } }, grid: { color: textColor + '15', borderDash: [5 * scaleMultiplier, 5 * scaleMultiplier], drawBorder: false, lineWidth: 1 * scaleMultiplier } }
                    };
                    if (type === 'line') {
                        datasetExtra = { backgroundColor: finalColors[0] + '20', borderColor: finalColors[0], tension: 0.4, fill: true, pointBackgroundColor: bgColor, pointBorderColor: finalColors[0], pointBorderWidth: borderWidth, pointRadius: 6 * scaleMultiplier };
                    } else {
                        datasetExtra = { backgroundColor: finalColors, borderColor: 'transparent', borderRadius: 6 * scaleMultiplier, borderSkipped: false };
                    }
                } else if (type === 'radar' || type === 'polarArea') {
                    scalesConfig = { r: { grid: { color: textColor + '22', borderDash: [5 * scaleMultiplier, 5 * scaleMultiplier], lineWidth: 1 * scaleMultiplier }, pointLabels: { color: textColor, font: { size: fontAxis, weight: 'bold' } }, ticks: { display: false, backdropColor: 'transparent' } } };
                    datasetExtra = { backgroundColor: finalColors, borderColor: bgColor };
                } else {
                    datasetExtra = { backgroundColor: finalColors, borderColor: bgColor, borderWidth: (type === 'doughnut' ? 3 : 2) * scaleMultiplier, cutout: type === 'doughnut' ? '60%' : '0%' };
                }
                chartData = { labels: labels, datasets: [{ label: title, data: data, ...datasetExtra }] };
            }

            const customLegendLabels = (chart) => {
                const original = Chart.defaults.plugins.legend.labels.generateLabels(chart);
                if (type === 'line' || type === 'radar') return original;
                if (type === 'singleline') {
                    return chart.data.datasets.map((ds, i) => ({
                        text: showValues ? `${ds.label}: ${ds.data[0]}` : ds.label,
                        fillStyle: ds.backgroundColor, strokeStyle: 'transparent', pointStyle: 'circle', index: i, datasetIndex: i
                    }));
                }
                if (chart.data.labels.length && chart.data.datasets.length) {
                    return chart.data.labels.map((label, i) => {
                        const ds = chart.data.datasets[0];
                        const val = ds.data[i];
                        const fill = Array.isArray(ds.backgroundColor) ? ds.backgroundColor[i] : ds.backgroundColor;
                        return {
                            text: showValues ? `${label}: ${val}` : label,
                            fillStyle: fill, strokeStyle: 'transparent', pointStyle: 'circle', index: i
                        };
                    });
                }
                return original;
            };

            return {
                type: chartTypeConfig,
                data: chartData,
                options: {
                    responsive: true, maintainAspectRatio: false, layout: { padding: paddingBase },
                    indexAxis: (type === 'progressbar' || type === 'singleline') ? 'y' : 'x',
                    plugins: {
                        legend: {
                            position: legendPos,
                            labels: { color: textColor, usePointStyle: true, padding: paddingLegend, font: { size: fontLegend, weight: 500 }, generateLabels: customLegendLabels },
                            onClick: (type === 'bar' || type === 'progressbar') ? null : Chart.defaults.plugins.legend.onClick
                        },
                        title: { display: true, text: title, color: textColor, font: { size: fontTitle, weight: 'bold', family: 'sans-serif' }, padding: { bottom: 25 * scaleMultiplier } },
                        tooltip: { callbacks: { title: (items) => type === 'singleline' ? items[0].dataset.label : items[0].label, label: (item) => { let label = item.dataset.label || ''; if (label && type !== 'singleline') label += ': '; if (type === 'singleline') return item.raw; return label + item.formattedValue; } } }
                    },
                    scales: scalesConfig
                }
            };
        }

        function updateChart() {
            const ctx = document.getElementById('myChart').getContext('2d');
            document.getElementById('chartContainer').style.backgroundColor = document.getElementById('bgColor').value;
            const config = getChartConfiguration(1);
            if (chart) chart.destroy();
            chart = new Chart(ctx, config);
        }

        function syncHex(colorId, hexId) { document.getElementById(hexId).value = document.getElementById(colorId).value.toUpperCase(); }
        function syncColor(hexId, colorId) {
            const val = document.getElementById(hexId).value;
            if (/^#[0-9A-F]{6}$/i.test(val)) document.getElementById(colorId).value = val;
        }
        function showNotification(msg) {
            const notif = document.createElement('div');
            notif.className = 'notification';
            notif.innerText = msg;
            document.body.appendChild(notif);
            setTimeout(() => notif.remove(), 2000);
        }
        function createPaddedCanvas() {
            const canvas = document.getElementById('myChart');
            const bgColor = document.getElementById('bgColor').value;
            const padding = 60;
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            tempCanvas.width = canvas.width + padding;
            tempCanvas.height = canvas.height + padding;
            tempCtx.fillStyle = bgColor;
            tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
            tempCtx.drawImage(canvas, padding / 2, padding / 2);
            return tempCanvas;
        }
        function downloadImage() {
            const link = document.createElement('a');
            link.download = 'chart.png';
            link.href = createPaddedCanvas().toDataURL();
            link.click();
            showNotification('‚úÖ ' + (currentLang === 'ru' ? 'PNG —Å–æ—Ö—Ä–∞–Ω–µ–Ω' : 'PNG saved'));
        }
        function copyMarkdown() {
            const mk = `![–ì—Ä–∞—Ñ–∏–∫](${createPaddedCanvas().toDataURL('image/png')})`;
            navigator.clipboard.writeText(mk).then(() => {
                showNotification('‚úÖ ' + (currentLang === 'ru' ? 'Markdown —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!' : 'Markdown copied!'));
                document.getElementById('codeOutput').style.display = 'block';
                document.getElementById('codeArea').value = mk;
            });
        }
        function copyHTML() {
            const type = document.getElementById('chartType').value;
            const labels = document.getElementById('labels').value.trim();
            const data = document.getElementById('data').value.trim();
            const title = document.getElementById('chartTitle').value;
            const bg = document.getElementById('bgColor').value;
            const text = document.getElementById('textColor').value;
            const showValues = document.getElementById('showLegendValues').checked;
            const legendPos = document.getElementById('legendPosition').value;
            const colorsArr = getActiveColors().map(c => `'${c}'`).join(', ');

            const sizeTitle = document.getElementById('fontSizeTitle').value || 20;
            const sizeLegend = document.getElementById('fontSizeLegend').value || 14;
            const sizeAxis = document.getElementById('fontSizeAxis').value || 12;

            const htmlCode = `<!DOCTYPE html>
<html><head><meta charset="UTF-8"><script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"><\/script>
<style>body{background:${bg};display:flex;justify-content:center;align-items:center;min-height:100vh;margin:0;font-family:sans-serif;}.box{width:100%;max-width:800px;height:500px;padding:40px;box-sizing:border-box;}</style></head>
<body><div class="box"><canvas id="c"></canvas></div>
<script>
const ctx=document.getElementById('c'), type='${type}', labels=[${labels.split(',').map(s => `'${s.trim()}'`).join(',')}], dataArr=[${data}], colors=[${colorsArr}], title='${title}', textColor='${text}', bgColor='${bg}', showValues=${showValues};
const getColors=(c,l)=>{let r=[];for(let i=0;i<l;i++)r.push(c[i%c.length]);return r}, finalColors=getColors(colors, dataArr.length);
let config={type:type==='progressbar'||type==='singleline'?'bar':type,data:{},options:{}};
if(type==='singleline'){
        config.data={labels:[''],datasets:labels.map((l,i)=>({label:l,data:[dataArr[i]],backgroundColor:finalColors[i],borderColor:bgColor,borderWidth:{right:2},barThickness:50,borderRadius:10}))};
        config.options={indexAxis:'y',scales:{x:{stacked:true,display:false},y:{stacked:true,display:false}}};
}else if(type==='progressbar'){
        config.data={labels:labels,datasets:[{label:title,data:dataArr,indexAxis:'y',barThickness:30,borderRadius:20,backgroundColor:finalColors}]};
        config.options={indexAxis:'y',scales:{x:{min:0,max:Math.max(100,...dataArr),display:false},y:{grid:{display:false},ticks:{color:textColor,font:{size:${sizeAxis},weight:'bold'}}}}};
}else{
        let ds={label:title,data:dataArr,backgroundColor:finalColors,borderColor:bgColor};
        if(type==='line'){ds.fill=true;ds.backgroundColor=finalColors[0]+'20';ds.borderColor=finalColors[0];ds.tension=0.4;}
        if(type==='doughnut'){ds.cutout='60%';ds.borderWidth=3;}
        config.data={labels:labels,datasets:[ds]};
        config.options.scales=(type==='pie'||type==='doughnut'||type==='radar'||type==='polarArea')?{}:{x:{grid:{display:false},ticks:{color:textColor,font:{size:${sizeAxis}}}},y:{grid:{display:false},ticks:{color:textColor,font:{size:${sizeAxis}}}}};
        if(type==='radar'||type==='polarArea')config.options.scales={r:{grid:{color:textColor+'22'},pointLabels:{color:textColor,font:{size:${sizeAxis},weight:'bold'}},ticks:{display:false}}};
}
config.options.plugins={title:{display:true,text:title,color:textColor,font:{size:${sizeTitle}}},legend:{position:'${legendPos}',labels:{color:textColor,font:{size:${sizeLegend}},usePointStyle:true,generateLabels:(chart)=>{const orig=Chart.defaults.plugins.legend.labels.generateLabels(chart);if(type==='line'||type==='radar')return orig;if(type==='singleline'){return chart.data.datasets.map((ds,i)=>({text:showValues?ds.label+': '+ds.data[0]:ds.label,fillStyle:ds.backgroundColor,strokeStyle:'transparent',pointStyle:'circle',index:i,datasetIndex:i}));}if(chart.data.labels.length){return chart.data.labels.map((l,i)=>({text:showValues?l+': '+chart.data.datasets[0].data[i]:l,fillStyle:chart.data.datasets[0].backgroundColor[i],strokeStyle:'transparent',pointStyle:'circle',index:i}));}return orig;}}}};
config.options.responsive=true;config.options.maintainAspectRatio=false;new Chart(ctx,config);
<\/script></body></html>`;
            document.getElementById('codeArea').value = htmlCode;
            document.getElementById('codeOutput').style.display = 'block';
            navigator.clipboard.writeText(htmlCode).then(() => showNotification('‚úÖ ' + (currentLang === 'ru' ? 'HTML —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!' : 'HTML copied!')));
        }

        function triggerImport() { document.getElementById('importFile').click(); }
        function exportProject() {
            const config = {
                chartType: document.getElementById('chartType').value,
                labels: document.getElementById('labels').value,
                data: document.getElementById('data').value,
                chartTitle: document.getElementById('chartTitle').value,
                legendPosition: document.getElementById('legendPosition').value,
                showLegendValues: document.getElementById('showLegendValues').checked,
                fontSizeTitle: document.getElementById('fontSizeTitle').value,
                fontSizeLegend: document.getElementById('fontSizeLegend').value,
                fontSizeAxis: document.getElementById('fontSizeAxis').value,
                bgColor: document.getElementById('bgColor').value,
                textColor: document.getElementById('textColor').value,
                colors: getActiveColors(),
                lang: currentLang,
                isDarkMode: document.body.classList.contains('dark-mode'),
                isTableMode: isTableMode
            };
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(config, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "chart-project.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
            showNotification(currentLang === 'ru' ? '‚úÖ –ü—Ä–æ–µ–∫—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω!' : '‚úÖ Project saved!');
        }
        function importProject(input) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const config = JSON.parse(e.target.result);
                    if (config.lang && config.lang !== currentLang) {
                        currentLang = config.lang;
                        localStorage.setItem('chartBuilderLang', currentLang);
                        applyLanguage(currentLang);
                    }
                    if (config.isDarkMode !== undefined && config.isDarkMode !== document.body.classList.contains('dark-mode')) toggleTheme();
                    document.getElementById('chartType').value = config.chartType;
                    document.getElementById('labels').value = config.labels;
                    document.getElementById('data').value = config.data;
                    document.getElementById('chartTitle').value = config.chartTitle || config.title;
                    document.getElementById('legendPosition').value = config.legendPosition;
                    document.getElementById('showLegendValues').checked = config.showLegendValues;
                    document.getElementById('fontSizeTitle').value = config.fontSizeTitle || 20;
                    document.getElementById('fontSizeLegend').value = config.fontSizeLegend || 14;
                    document.getElementById('fontSizeAxis').value = config.fontSizeAxis || 12;
                    document.getElementById('bgColor').value = config.bgColor;
                    document.getElementById('hexBg').value = config.bgColor.toUpperCase();
                    document.getElementById('textColor').value = config.textColor;
                    document.getElementById('hexText').value = config.textColor.toUpperCase();

                    const colorList = document.getElementById('dataColorsList');
                    colorList.innerHTML = '';
                    colorCounter = 0;
                    if (config.colors && Array.isArray(config.colors)) {
                        config.colors.forEach(c => addNewColorInput(c, false));
                    } else {
                        defaultColors.forEach(c => addNewColorInput(c, false));
                    }
                    saveColors();

                    if (isTableMode) syncInputsToTable();
                    if (config.isTableMode !== undefined && config.isTableMode !== isTableMode) toggleInputMode();
                    updateChart();
                    showNotification(currentLang === 'ru' ? '‚úÖ –ü—Ä–æ–µ–∫—Ç –∑–∞–≥—Ä—É–∂–µ–Ω!' : '‚úÖ Project loaded!');
                } catch (error) { showNotification(currentLang === 'ru' ? '‚ùå –û—à–∏–±–∫–∞ —Ñ–∞–π–ª–∞' : '‚ùå File error'); }
            };
            reader.readAsText(file);
            input.value = '';
        }
    </script>

    <script data-goatcounter="https://dontaz.goatcounter.com/count"
            async src="//gc.zgo.at/count.js"></script>

</body>
</html>